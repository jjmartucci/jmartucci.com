---
import FormattedDate from "../FormattedDate.astro";
import Tag from "../Tag/Tag.astro";
import styles from "./PostPreview.module.css";
const { post } = Astro.props;
import { Image } from 'astro:assets';

let imageUrl = null;
if(post.data.image) {
  try {
    imageUrl = await import(`../../content/${post.data.image}`)
  } catch(e) {
    imageUrl = null
  }
}
---

<div class={styles.PostPreview}>
  <a href={`/blog/${post.slug}/`}>
    {imageUrl &&
        <div class={styles.heroWrapper}>
         <Image src={imageUrl.default} alt=""/>
          <Image src={imageUrl.default} alt=""  class={styles.dupeImage}/>
          <span class={[styles.date, styles.topDate].join(" ")}>
      <FormattedDate date={post.data.published} />
    </span>
          <div class={styles.infoWrapper}>
            <h4 class={styles.title}>{post.data.title}</h4>
          </div>
        </div>}
    {!imageUrl &&

        <h4 class={styles.title}>{post.data.title}</h4>
        <span class={styles.date}><FormattedDate date={post.data.published} /></span>

    }

    <p class={styles.description}>{post.data.description}</p>
  </a>
  <div class={styles.footer}>
    {
      post.data.tags && (
        <ul class={styles.tagList}>
          {post.data.tags.map((tag: string) => (
            <li class={styles.tagList__tag}>
              <Tag tag={tag} />
            </li>
          ))}
        </ul>
      )
    }
  </div>
</div>
